#pragma once
#include <stdint.h>
#include <assert.h>
#include "opcode.h"

static const uint32_t RCP_SPLIT_NUM = 128;
static const uint32_t LOG_SPLIT_NUM = 64;
static const uint32_t EXP_SPLIT_NUM = 32;
static const uint32_t SIN_SPLIT_NUM = 32;
static const uint32_t EXPAND_ITEM_NUM = 3;

//typedef struct {
//    uint32_t sign : 1;
//    uint32_t exp : 8;
//    uint32_t x1 : 6;
//    uint32_t x2 : 17;
//} LogBinary;


typedef struct {
    uint32_t x2 : 17;
    uint32_t x1 : 6;
    uint32_t exp : 8;
    uint32_t sign : 1;
} LogBinaryBase;


typedef union
{
    float value;
    LogBinaryBase logBinary;
    uint32_t bin_f;

} BinaryBase;

const uint64_t log_database[LOG_SPLIT_NUM * EXPAND_ITEM_NUM] =
{
    0xfffffffffa406bce,0xfffffffffffd230d,0xfffffffffffffa50,
    0xfffffffff7719713,0xfffffffffffd2e3e,0xfffffffffffffa7d,
    0xfffffffff8ec8150,0xfffffffffffd3918,0xfffffffffffffaa7,
    0xfffffffff62ae810,0xfffffffffffd43a1,0xfffffffffffffacf,
    0xfffffffff9b9d7a3,0xfffffffffffd4dda,0xfffffffffffffaf5,
    0xfffffffff86344fa,0xfffffffffffd57c8,0xfffffffffffffb1a,
    0xfffffffff7119733,0xfffffffffffd616e,0xfffffffffffffb3d,
    0xfffffffff5c4ab02,0xfffffffffffd6acf,0xfffffffffffffb5f,
    0xfffffffffa3e2f4a,0xfffffffffffd73ee,0xfffffffffffffb80,
    0xfffffffff99c48bd,0xfffffffffffd7ccd,0xfffffffffffffb9f,
    0xfffffffff8fc924b,0xfffffffffffd856f,0xfffffffffffffbbd,
    0xfffffffff85efd05,0xfffffffffffd8dd7,0xfffffffffffffbd9,
    0xfffffffff7c37a91,0xfffffffffffd9607,0xfffffffffffffbf5,
    0xfffffffff729fd26,0xfffffffffffd9e00,0xfffffffffffffc10,
    0xfffffffff6927781,0xfffffffffffda5c5,0xfffffffffffffc29,
    0xfffffffff5fcdce1,0xfffffffffffdad59,0xfffffffffffffc42,
    0xfffffffffab49080,0xfffffffffffdb4bc,0xfffffffffffffc59,
    0xfffffffffa6b9c06,0xfffffffffffdbbf0,0xfffffffffffffc70,
    0xfffffffffa238b50,0xfffffffffffdc2f8,0xfffffffffffffc86,
    0xfffffffff9dc58e2,0xfffffffffffdc9d5,0xfffffffffffffc9b,
    0xfffffffff995ff71,0xfffffffffffdd088,0xfffffffffffffcb0,
    0xfffffffff95079e1,0xfffffffffffdd714,0xfffffffffffffcc3,
    0xfffffffff90bc344,0xfffffffffffddd78,0xfffffffffffffcd6,
    0xfffffffff8c7d6da,0xfffffffffffde3b7,0xfffffffffffffce9,
    0xfffffffff884b00a,0xfffffffffffde9d2,0xfffffffffffffcfa,
    0xfffffffff8424a62,0xfffffffffffdefca,0xfffffffffffffd0c,
    0xfffffffff800a198,0xfffffffffffdf5a0,0xfffffffffffffd1c,
    0xfffffffff7bfb186,0xfffffffffffdfb55,0xfffffffffffffd2c,
    0xfffffffff77f7626,0xfffffffffffe00eb,0xfffffffffffffd3c,
    0xfffffffff73feb97,0xfffffffffffe0663,0xfffffffffffffd4b,
    0xfffffffff7010e15,0xfffffffffffe0bbc,0xfffffffffffffd59,
    0xfffffffff6c2d9fc,0xfffffffffffe10f9,0xfffffffffffffd68,
    0xfffffffff97ab43a,0xfffffffffffe161b,0xfffffffffffffd75,
    0xfffffffff9b79ffd,0xfffffffffffe1b21,0xfffffffffffffd82,
    0xfffffffff9f3ec9b,0xfffffffffffe200d,0xfffffffffffffd8f,
    0xfffffffffa2f9d4b,0xfffffffffffe24e0,0xfffffffffffffd9c,
    0xfffffffffa6ab52d,0xfffffffffffe299a,0xfffffffffffffda8,
    0xfffffffffaa53745,0xfffffffffffe2e3d,0xfffffffffffffdb4,
    0xfffffffffadf2685,0xfffffffffffe32c8,0xfffffffffffffdbf,
    0xfffffffffb1885c7,0xfffffffffffe373d,0xfffffffffffffdca,
    0xfffffffffb5157ce,0xfffffffffffe3b9c,0xfffffffffffffdd5,
    0xfffffffffb899f4d,0xfffffffffffe3fe6,0xfffffffffffffddf,
    0xfffffffffbc15edf,0xfffffffffffe441b,0xfffffffffffffde9,
    0xfffffffffbf89910,0xfffffffffffe483c,0xfffffffffffffdf3,
    0xfffffffffc2f5057,0xfffffffffffe4c49,0xfffffffffffffdfd,
    0xfffffffffc65871d,0xfffffffffffe5044,0xfffffffffffffe06,
    0xfffffffffc9b3fb6,0xfffffffffffe542c,0xfffffffffffffe0f,
    0xfffffffffcd07c69,0xfffffffffffe5803,0xfffffffffffffe18,
    0xfffffffffa0a7ed9,0xfffffffffffe5bc7,0xfffffffffffffe21,
    0xfffffffffa7315cf,0xfffffffffffe5f7b,0xfffffffffffffe29,
    0xfffffffffadac1e6,0xfffffffffffe631e,0xfffffffffffffe31,
    0xfffffffffb418734,0xfffffffffffe66b2,0xfffffffffffffe39,
    0xfffffffffba769b3,0xfffffffffffe6a35,0xfffffffffffffe41,
    0xfffffffffc0c6d44,0xfffffffffffe6da9,0xfffffffffffffe49,
    0xfffffffffc7095ae,0xfffffffffffe710e,0xfffffffffffffe50,
    0xfffffffffcd3e6a0,0xfffffffffffe7465,0xfffffffffffffe57,
    0xfffffffffa6cc764,0xfffffffffffe77ad,0xfffffffffffffe5e,
    0xfffffffffb3020c8,0xfffffffffffe7ae8,0xfffffffffffffe65,
    0xfffffffffbf1e040,0xfffffffffffe7e15,0xfffffffffffffe6c,
    0xfffffffffcb20c78,0xfffffffffffe8135,0xfffffffffffffe72,
    0xfffffffffae157e2,0xfffffffffffe8448,0xfffffffffffffe79,
    0xfffffffffc5b8a06,0xfffffffffffe874f,0xfffffffffffffe7f,
    0xfffffffffba57787,0xfffffffffffe8a49,0xfffffffffffffe85,
    0xfffffffffd1be4c7,0xfffffffffffe8d37,0xfffffffffffffe8b,
};


const uint64_t rcp_database[RCP_SPLIT_NUM * EXPAND_ITEM_NUM] =
{
    0xfffffffff00ff00f,0xfffffffffffc07f0,0xfffffffffffff817,
    0xfffffffff02f71aa,0xfffffffffffc1792,0xfffffffffffff845,
    0xfffffffff04e77a9,0xfffffffffffc26d8,0xfffffffffffff872,
    0xfffffffff06d04dd,0xfffffffffffc35c5,0xfffffffffffff89e,
    0xfffffffff08b1c03,0xfffffffffffc445c,0xfffffffffffff8c9,
    0xfffffffff0a8bfc2,0xfffffffffffc529f,0xfffffffffffff8f2,
    0xfffffffff0c5f2ac,0xfffffffffffc6092,0xfffffffffffff91a,
    0xfffffffff0e2b742,0xfffffffffffc6e35,0xfffffffffffff941,
    0xfffffffff0ff0ff0,0xfffffffffffc7b8c,0xfffffffffffff966,
    0xfffffffff11aff11,0xfffffffffffc8899,0xfffffffffffff98b,
    0xfffffffff13686ed,0xfffffffffffc955e,0xfffffffffffff9ae,
    0xfffffffff151a9bf,0xfffffffffffca1dc,0xfffffffffffff9d1,
    0xfffffffff16c69ad,0xfffffffffffcae17,0xfffffffffffff9f2,
    0xfffffffff186c8d1,0xfffffffffffcba0f,0xfffffffffffffa13,
    0xfffffffff1a0c934,0xfffffffffffcc5c7,0xfffffffffffffa33,
    0xfffffffff1ba6cd2,0xfffffffffffcd141,0xfffffffffffffa52,
    0xfffffffff1d3b596,0xfffffffffffcdc7e,0xfffffffffffffa6f,
    0xfffffffff1eca562,0xfffffffffffce780,0xfffffffffffffa8d,
    0xfffffffff2053e08,0xfffffffffffcf248,0xfffffffffffffaa9,
    0xfffffffff21d814c,0xfffffffffffcfcd8,0xfffffffffffffac5,
    0xfffffffff23570e9,0xfffffffffffd0732,0xfffffffffffffadf,
    0xfffffffff24d0e8d,0xfffffffffffd1157,0xfffffffffffffafa,
    0xfffffffff2645bda,0xfffffffffffd1b48,0xfffffffffffffb13,
    0xfffffffff27b5a66,0xfffffffffffd2507,0xfffffffffffffb2c,
    0xfffffffff2920bbf,0xfffffffffffd2e95,0xfffffffffffffb44,
    0xfffffffff2a87167,0xfffffffffffd37f4,0xfffffffffffffb5b,
    0xfffffffff2be8cd6,0xfffffffffffd4124,0xfffffffffffffb72,
    0xfffffffff2d45f7b,0xfffffffffffd4a27,0xfffffffffffffb89,
    0xfffffffff2e9eabb,0xfffffffffffd52fd,0xfffffffffffffb9e,
    0xfffffffff2ff2ff2,0xfffffffffffd5ba9,0xfffffffffffffbb4,
    0xfffffffff3143073,0xfffffffffffd642b,0xfffffffffffffbc8,
    0xfffffffff328ed8a,0xfffffffffffd6c84,0xfffffffffffffbdd,
    0xfffffffff33d6878,0xfffffffffffd74b5,0xfffffffffffffbf0,
    0xfffffffff351a279,0xfffffffffffd7cc0,0xfffffffffffffc03,
    0xfffffffff3659cbf,0xfffffffffffd84a4,0xfffffffffffffc16,
    0xfffffffff3795876,0xfffffffffffd8c64,0xfffffffffffffc28,
    0xfffffffff38cd6c2,0xfffffffffffd93ff,0xfffffffffffffc3a,
    0xfffffffff3a018bf,0xfffffffffffd9b77,0xfffffffffffffc4c,
    0xfffffffff3b31f84,0xfffffffffffda2cd,0xfffffffffffffc5c,
    0xfffffffff3c5ec21,0xfffffffffffdaa02,0xfffffffffffffc6d,
    0xfffffffff3d87f9e,0xfffffffffffdb115,0xfffffffffffffc7d,
    0xfffffffff3eadafe,0xfffffffffffdb809,0xfffffffffffffc8d,
    0xfffffffff3fcff3f,0xfffffffffffdbede,0xfffffffffffffc9c,
    0xfffffffff40eed56,0xfffffffffffdc594,0xfffffffffffffcac,
    0xfffffffff420a636,0xfffffffffffdcc2c,0xfffffffffffffcba,
    0xfffffffff4322ac9,0xfffffffffffdd2a7,0xfffffffffffffcc9,
    0xfffffffff4437bf6,0xfffffffffffdd905,0xfffffffffffffcd7,
    0xfffffffff4549a9e,0xfffffffffffddf48,0xfffffffffffffce4,
    0xfffffffff465879c,0xfffffffffffde570,0xfffffffffffffcf2,
    0xfffffffff47643c8,0xfffffffffffdeb7d,0xfffffffffffffcff,
    0xfffffffff486cff4,0xfffffffffffdf170,0xfffffffffffffd0c,
    0xfffffffff4972cec,0xfffffffffffdf74a,0xfffffffffffffd18,
    0xfffffffff4a75b7a,0xfffffffffffdfd0b,0xfffffffffffffd25,
    0xfffffffff4b75c62,0xfffffffffffe02b4,0xfffffffffffffd31,
    0xfffffffff4c73064,0xfffffffffffe0844,0xfffffffffffffd3c,
    0xfffffffff4d6d83c,0xfffffffffffe0dbe,0xfffffffffffffd48,
    0xfffffffff4e654a3,0xfffffffffffe1321,0xfffffffffffffd53,
    0xfffffffff4f5a64b,0xfffffffffffe186e,0xfffffffffffffd5e,
    0xfffffffff504cde5,0xfffffffffffe1da5,0xfffffffffffffd69,
    0xfffffffff513cc1d,0xfffffffffffe22c6,0xfffffffffffffd73,
    0xfffffffff522a19c,0xfffffffffffe27d3,0xfffffffffffffd7e,
    0xfffffffff5314f06,0xfffffffffffe2ccc,0xfffffffffffffd88,
    0xfffffffff53fd4fe,0xfffffffffffe31b0,0xfffffffffffffd92,
    0xfffffffff54e3422,0xfffffffffffe3681,0xfffffffffffffd9b,
    0xfffffffff55c6d0c,0xfffffffffffe3b3e,0xfffffffffffffda5,
    0xfffffffff56a8054,0xfffffffffffe3fe9,0xfffffffffffffdae,
    0xfffffffff5786e8e,0xfffffffffffe4482,0xfffffffffffffdb7,
    0xfffffffff586384e,0xfffffffffffe4908,0xfffffffffffffdc0,
    0xfffffffff593de20,0xfffffffffffe4d7d,0xfffffffffffffdc9,
    0xfffffffff5a16090,0xfffffffffffe51e1,0xfffffffffffffdd1,
    0xfffffffff5aec028,0xfffffffffffe5633,0xfffffffffffffdda,
    0xfffffffff5bbfd6e,0xfffffffffffe5a75,0xfffffffffffffde2,
    0xfffffffff5c918e5,0xfffffffffffe5ea7,0xfffffffffffffdea,
    0xfffffffff5d6130e,0xfffffffffffe62c9,0xfffffffffffffdf2,
    0xfffffffff5e2ec67,0xfffffffffffe66db,0xfffffffffffffdfa,
    0xfffffffff5efa56c,0xfffffffffffe6ade,0xfffffffffffffe01,
    0xfffffffff5fc3e96,0xfffffffffffe6ed2,0xfffffffffffffe09,
    0xfffffffff608b85e,0xfffffffffffe72b7,0xfffffffffffffe10,
    0xfffffffff6151336,0xfffffffffffe768e,0xfffffffffffffe17,
    0xfffffffff6214f92,0xfffffffffffe7a56,0xfffffffffffffe1e,
    0xfffffffff62d6de3,0xfffffffffffe7e11,0xfffffffffffffe25,
    0xfffffffff6396e95,0xfffffffffffe81be,0xfffffffffffffe2c,
    0xfffffffff6455216,0xfffffffffffe855d,0xfffffffffffffe33,
    0xfffffffff65118cf,0xfffffffffffe88f0,0xfffffffffffffe39,
    0xfffffffff65cc329,0xfffffffffffe8c75,0xfffffffffffffe3f,
    0xfffffffff6685188,0xfffffffffffe8fee,0xfffffffffffffe46,
    0xfffffffff673c453,0xfffffffffffe935b,0xfffffffffffffe4c,
    0xfffffffff67f1bea,0xfffffffffffe96bb,0xfffffffffffffe52,
    0xfffffffff68a58ae,0xfffffffffffe9a0f,0xfffffffffffffe58,
    0xfffffffff6957afe,0xfffffffffffe9d58,0xfffffffffffffe5e,
    0xfffffffff6a08338,0xfffffffffffea095,0xfffffffffffffe63,
    0xfffffffff6ab71b6,0xfffffffffffea3c7,0xfffffffffffffe69,
    0xfffffffff6b646d1,0xfffffffffffea6ee,0xfffffffffffffe6e,
    0xfffffffff6c102e3,0xfffffffffffeaa09,0xfffffffffffffe74,
    0xfffffffff6cba641,0xfffffffffffead1b,0xfffffffffffffe79,
    0xfffffffff6d63140,0xfffffffffffeb021,0xfffffffffffffe7e,
    0xfffffffff6e0a433,0xfffffffffffeb31e,0xfffffffffffffe83,
    0xfffffffff6eaff6e,0xfffffffffffeb610,0xfffffffffffffe88,
    0xfffffffff6f5433f,0xfffffffffffeb8f8,0xfffffffffffffe8d,
    0xfffffffff6ff6ff6,0xfffffffffffebbd6,0xfffffffffffffe92,
    0xfffffffff70985e1,0xfffffffffffebeab,0xfffffffffffffe97,
    0xfffffffff713854b,0xfffffffffffec176,0xfffffffffffffe9c,
    0xfffffffff71d6e81,0xfffffffffffec438,0xfffffffffffffea0,
    0xfffffffff72741cb,0xfffffffffffec6f1,0xfffffffffffffea5,
    0xfffffffff730ff72,0xfffffffffffec9a1,0xfffffffffffffea9,
    0xfffffffff73aa7bd,0xfffffffffffecc48,0xfffffffffffffeae,
    0xfffffffff7443af2,0xfffffffffffecee7,0xfffffffffffffeb2,
    0xfffffffff74db957,0xfffffffffffed17c,0xfffffffffffffeb6,
    0xfffffffff757232d,0xfffffffffffed40a,0xfffffffffffffeba,
    0xfffffffff76078b8,0xfffffffffffed68f,0xfffffffffffffebe,
    0xfffffffff769ba3a,0xfffffffffffed90c,0xfffffffffffffec2,
    0xfffffffff772e7f2,0xfffffffffffedb82,0xfffffffffffffec6,
    0xfffffffff77c0220,0xfffffffffffeddef,0xfffffffffffffeca,
    0xfffffffff7850902,0xfffffffffffee055,0xfffffffffffffece,
    0xfffffffff78dfcd4,0xfffffffffffee2b3,0xfffffffffffffed2,
    0xfffffffff796ddd4,0xfffffffffffee50a,0xfffffffffffffed6,
    0xfffffffff79fac3c,0xfffffffffffee759,0xfffffffffffffed9,
    0xfffffffff7a86846,0xfffffffffffee9a1,0xfffffffffffffedd,
    0xfffffffff7b1122c,0xfffffffffffeebe2,0xfffffffffffffee0,
    0xfffffffff7b9aa25,0xfffffffffffeee1c,0xfffffffffffffee4,
    0xfffffffff7c2306a,0xfffffffffffef04f,0xfffffffffffffee7,
    0xfffffffff7caa531,0xfffffffffffef27c,0xfffffffffffffeea,
    0xfffffffff7d308af,0xfffffffffffef4a1,0xfffffffffffffeee,
    0xfffffffff7db5b19,0xfffffffffffef6c1,0xfffffffffffffef1,
    0xfffffffff7e39ca3,0xfffffffffffef8d9,0xfffffffffffffef4,
    0xfffffffff7ebcd81,0xfffffffffffefaec,0xfffffffffffffef7,
    0xfffffffff7f3ede4,0xfffffffffffefcf8,0xfffffffffffffefa,
    0xfffffffff7fbfdfe,0xfffffffffffefefe,0xfffffffffffffefd,
};

const uint64_t enhanced_log_t25_p15_q11_database[LOG_SPLIT_NUM * EXPAND_ITEM_NUM] = {
    0x2E2A8EB, 0x5C54, 0x3CA,
    0x2DCF2D0, 0x5A70, 0x3A8,
    0x2D75A6E, 0x589C, 0x386,
    0x2D1DEC4, 0x56D9, 0x36B,
    0x2CC7EDF, 0x5524, 0x34D,
    0x2C739D3, 0x537D, 0x330,
    0x2C20EC1, 0x51E5, 0x31A,
    0x2BCFCD7, 0x5059, 0x300,
    0x2B80346, 0x4ED9, 0x2E7,
    0x2B32150, 0x4D66, 0x2D2,
    0x2AE5636, 0x4BFD, 0x2BA,
    0x2A9A14D, 0x4AA0, 0x2A6,
    0x2A501E5, 0x494D, 0x292,
    0x2A0775D, 0x4804, 0x27F,
    0x29C0117, 0x46C4, 0x26B,
    0x2979E82, 0x458E, 0x25A,
    0x2934F09, 0x4461, 0x24B,
    0x28F1224, 0x433C, 0x23B,
    0x28AE74F, 0x421F, 0x22B,
    0x286CE0A, 0x410A, 0x21C,
    0x282C5DA, 0x3FFC, 0x20C,
    0x27ECE49, 0x3EF6, 0x200,
    0x27AE6E7, 0x3DF6, 0x1F0,
    0x2770F46, 0x3CFE, 0x1E6,
    0x27346FC, 0x3C0B, 0x1D7,
    0x26F8DA6, 0x3B1F, 0x1CB,
    0x26BE2E1, 0x3A39, 0x1BF,
    0x268464E, 0x3959, 0x1B5,
    0x264B793, 0x387E, 0x1A9,
    0x2613658, 0x37A9, 0x1A0,
    0x25DC248, 0x36D9, 0x197,
    0x25A5B12, 0x360E, 0x18E,
    0x2570069, 0x3547, 0x181,
    0x253B1FC, 0x3486, 0x17B,
    0x2506F86, 0x33C9, 0x172,
    0x24D38BE, 0x3310, 0x168,
    0x24A0D5D, 0x325C, 0x162,
    0x246ED23, 0x31AB, 0x157,
    0x243D7CF, 0x30FF, 0x150,
    0x240CD1F, 0x3057, 0x14B,
    0x23DCCDA, 0x2FB2, 0x143,
    0x23AD6C6, 0x2F11, 0x13C,
    0x237EAA7, 0x2E73, 0x134,
    0x2350846, 0x2DD9, 0x12F,
    0x2322F70, 0x2D42, 0x128,
    0x22F5FEF, 0x2CAE, 0x121,
    0x22C9993, 0x2C1D, 0x119,
    0x229DC28, 0x2B90, 0x116,
    0x2272780, 0x2B05, 0x10F,
    0x2247B6D, 0x2A7D, 0x109,
    0x221D7C1, 0x29F8, 0x105,
    0x21F3C53, 0x2976, 0x101,
    0x21CA8F8, 0x28F6, 0xFB,
    0x21A1D84, 0x2878, 0xF4,
    0x21799D4, 0x27FE, 0xF2,
    0x2151DBB, 0x2785, 0xEC,
    0x212A919, 0x270F, 0xE8,
    0x2103BC7, 0x269B, 0xE3,
    0x20DD5A2, 0x262A, 0xE1,
    0x20B7685, 0x25BA, 0xDB,
    0x2091E51, 0x254D, 0xD8,
    0x206CCE2, 0x24E1, 0xD2,
    0x2048219, 0x2478, 0xD0,
    0x2023DD8, 0x2410, 0xCA,
};


const uint64_t enhanced_log_div_t26_p15_q11_database[LOG_SPLIT_NUM * EXPAND_ITEM_NUM] = {
    0x5C551D5, 0x5C54, 0x3CA,
    0x5B9E59F, 0x5A70, 0x3A8,
    0x5AEB4DC, 0x589C, 0x386,
    0x5A3BD89, 0x56D9, 0x36B,
    0x598FDBF, 0x5524, 0x34D,
    0x58E73A5, 0x537D, 0x330,
    0x5841D81, 0x51E5, 0x31A,
    0x579F9AE, 0x5059, 0x300,
    0x570068B, 0x4ED9, 0x2E7,
    0x56642A0, 0x4D66, 0x2D2,
    0x55CAC6D, 0x4BFD, 0x2BA,
    0x5534299, 0x4AA0, 0x2A6,
    0x54A03C9, 0x494D, 0x292,
    0x540EEB9, 0x4804, 0x27F,
    0x538022E, 0x46C4, 0x26B,
    0x52F3D03, 0x458E, 0x25A,
    0x5269E12, 0x4461, 0x24B,
    0x51E2449, 0x433C, 0x23B,
    0x515CE9E, 0x421F, 0x22B,
    0x50D9C15, 0x410A, 0x21C,
    0x5058BB5, 0x3FFC, 0x20C,
    0x4FD9C92, 0x3EF6, 0x200,
    0x4F5CDCF, 0x3DF6, 0x1F0,
    0x4EE1E8C, 0x3CFE, 0x1E6,
    0x4E68DF8, 0x3C0B, 0x1D7,
    0x4DF1B4B, 0x3B1F, 0x1CB,
    0x4D7C5C2, 0x3A39, 0x1BF,
    0x4D08C9C, 0x3959, 0x1B5,
    0x4C96F26, 0x387E, 0x1A9,
    0x4C26CB0, 0x37A9, 0x1A0,
    0x4BB848F, 0x36D9, 0x197,
    0x4B4B624, 0x360E, 0x18E,
    0x4AE00D2, 0x3547, 0x181,
    0x4A763F8, 0x3486, 0x17B,
    0x4A0DF0D, 0x33C9, 0x172,
    0x49A717C, 0x3310, 0x168,
    0x4941AB9, 0x325C, 0x162,
    0x48DDA46, 0x31AB, 0x157,
    0x487AF9E, 0x30FF, 0x150,
    0x4819A3F, 0x3057, 0x14B,
    0x47B99B5, 0x2FB2, 0x143,
    0x475AD8C, 0x2F11, 0x13C,
    0x46FD54E, 0x2E73, 0x134,
    0x46A108B, 0x2DD9, 0x12F,
    0x4645EE0, 0x2D42, 0x128,
    0x45EBFDF, 0x2CAE, 0x121,
    0x4593326, 0x2C1D, 0x119,
    0x453B84F, 0x2B90, 0x116,
    0x44E4F00, 0x2B05, 0x10F,
    0x448F6DA, 0x2A7D, 0x109,
    0x443AF81, 0x29F8, 0x105,
    0x43E78A7, 0x2976, 0x101,
    0x43951F0, 0x28F6, 0xFB,
    0x4343B08, 0x2878, 0xF4,
    0x42F33A7, 0x27FE, 0xF2,
    0x42A3B76, 0x2785, 0xEC,
    0x4255232, 0x270F, 0xE8,
    0x420778E, 0x269B, 0xE3,
    0x41BAB43, 0x262A, 0xE1,
    0x416ED0A, 0x25BA, 0xDB,
    0x4123CA2, 0x254D, 0xD8,
    0x40D99C3, 0x24E1, 0xD2,
    0x4090432, 0x2478, 0xD0,
    0x4047BB0, 0x2410, 0xCA,
};


const uint64_t enhanced_log_div_split_t25_p15_q11_database[LOG_SPLIT_NUM * EXPAND_ITEM_NUM] = {
    0x2e2a8eb,	0x5c54,	0x3ca,
    0x2dcf2d0,	0x5a70,	0x3a8,
    0x2d75a6d,	0x589c,	0x386,
    0x2d1dec5,	0x56d9,	0x36b,
    0x2cc7edd,	0x5524,	0x34e,
    0x2c739d2,	0x537d,	0x330,
    0x2c20ec1,	0x51e5,	0x31a,
    0x2bcfcd5,	0x5059,	0x301,
    0x2b80346,	0x4ed9,	0x2e7,
    0x2b32151,	0x4d66,	0x2d2,
    0x2ae5636,	0x4bfd,	0x2ba,
    0x2a9a14d,	0x4aa0,	0x2a6,
    0x2a501e5,	0x494d,	0x292,
    0x2a0775d,	0x4804,	0x27f,
    0x29c0117,	0x46c4,	0x26b,
    0x2979e81,	0x458e,	0x25a,
    0x2934f0a,	0x4461,	0x24b,
    0x28f1225,	0x433c,	0x23b,
    0x28ae74f,	0x421f,	0x22b,
    0x286ce0b,	0x410a,	0x21c,
    0x282c5da,	0x3ffc,	0x20c,
    0x27ece49,	0x3ef6,	0x200,
    0x27ae6e7,	0x3df6,	0x1f0,
    0x2770f47,	0x3cfe,	0x1e6,
    0x27346fc,	0x3c0b,	0x1d7,
    0x26f8da5,	0x3b1f,	0x1cb,
    0x26be2e0,	0x3a39,	0x1bf,
    0x268464e,	0x3959,	0x1b5,
    0x264b791,	0x387e,	0x1aa,
    0x2613658,	0x37a9,	0x1a0,
    0x25dc248,	0x36d9,	0x197,
    0x25a5b12,	0x360e,	0x18e,
    0x34dcf61,	0x8512,	0x73c,
    0x349addf,	0x834e,	0x711,
    0x3459a58,	0x8194,	0x6e7,
    0x341947d,	0x7fe3,	0x6c2,
    0x33d9bff,	0x7e3c,	0x69d,
    0x339b091,	0x7c9f,	0x675,
    0x335d1ef,	0x7b0a,	0x652,
    0x331ffd0,	0x797e,	0x62f,
    0x32e39f1,	0x77fa,	0x60f,
    0x32a8010,	0x767e,	0x5f0,
    0x326d1ea,	0x750b,	0x5ce,
    0x3232f43,	0x739f,	0x5af,
    0x31f97e1,	0x723a,	0x593,
    0x31c0b84,	0x70dd,	0x574,
    0x31889f8,	0x6f86,	0x55b,
    0x3151301,	0x6e37,	0x53e,
    0x311a66d,	0x6cee,	0x524,
    0x30e4405,	0x6bac,	0x508,
    0x30aeb9b,	0x6a6f,	0x4f2,
    0x3079cf7,	0x6939,	0x4da,
    0x30457ec,	0x6809,	0x4c1,
    0x3011c4a,	0x66df,	0x4a9,
    0x2fde9e7,	0x65ba,	0x493,
    0x2fac093,	0x649b,	0x47c,
    0x2f7a024,	0x6381,	0x467,
    0x2f48871,	0x626c,	0x453,
    0x2f17950,	0x615c,	0x440,
    0x2ee729a,	0x6051,	0x42d,
    0x2eb7427,	0x5f4b,	0x419,
    0x2e87dd1,	0x5e4a,	0x405,
    0x2e58f75,	0x5d4d,	0x3f4,
    0x2e2a8ec,	0x5c55,	0x3e0,
};


// item0 > 0 and item1 > 0, item2 < 0.
const uint64_t enhanced_log_t25_p15_q10_database[LOG_SPLIT_NUM * EXPAND_ITEM_NUM] = {
    0x2, 0xB8A8, 0x2D7,
    0xB73CB, 0xB5D1, 0x2C1,
    0x16BAD6, 0xB310, 0x2AD,
    0x21D674, 0xB064, 0x299,
    0x2CC7F1, 0xADCC, 0x286,
    0x379087, 0xAB47, 0x273,
    0x423165, 0xA8D5, 0x262,
    0x4CABA8, 0xA674, 0x250,
    0x57006C, 0xA424, 0x240,
    0x6130B0, 0xA1E4, 0x22F,
    0x6B3D79, 0x9FB4, 0x220,
    0x7527BA, 0x9D93, 0x212,
    0x7EF05D, 0x9B81, 0x206,
    0x88983E, 0x997C, 0x1F8,
    0x92203E, 0x9784, 0x1EB,
    0x9B8928, 0x9599, 0x1DF,
    0xA4D3C2, 0x93BA, 0x1D2,
    0xAE00D4, 0x91E7, 0x1C7,
    0xB71111, 0x9020, 0x1BD,
    0xC0052C, 0x8E63, 0x1B1,
    0xC8DDD6, 0x8CB2, 0x1A9,
    0xD19BB0, 0x8B0A, 0x19E,
    0xDA3F5F, 0x896C, 0x194,
    0xE2C97E, 0x87D8, 0x18C,
    0xEB3A9E, 0x864C, 0x181,
    0xF39354, 0x84CA, 0x179,
    0xFBD42A, 0x8350, 0x170,
    0x103FDA8, 0x81DF, 0x169,
    0x10C1050, 0x8076, 0x162,
    0x1140CA1, 0x7F14, 0x15A,
    0x11BF314, 0x7DBA, 0x153,
    0x123C41D, 0x7C67, 0x14B,
    0x12B8036, 0x7B1C, 0x146,
    0x13327C7, 0x79D7, 0x13F,
    0x13ABB40, 0x7898, 0x137,
    0x1423B0A, 0x7761, 0x133,
    0x149A787, 0x762F, 0x12C,
    0x1510119, 0x7503, 0x125,
    0x1584821, 0x73DE, 0x120,
    0x15F7D00, 0x72BE, 0x11B,
    0x166A008, 0x71A3, 0x114,
    0x16DB196, 0x708E, 0x10F,
    0x174B1FE, 0x6F7E, 0x10A,
    0x17BA18E, 0x6E74, 0x106,
    0x182809D, 0x6D6E, 0x101,
    0x1894F73, 0x6C6D, 0xFC,
    0x1900E63, 0x6B71, 0xF9,
    0x196BDAE, 0x6A79, 0xF4,
    0x19D5DA0, 0x6985, 0xEE,
    0x1A3EE7F, 0x6896, 0xEA,
    0x1AA7091, 0x67AC, 0xE8,
    0x1B0E412, 0x66C5, 0xE3,
    0x1B74949, 0x65E2, 0xDF,
    0x1BDA072, 0x6503, 0xDB,
    0x1C3E9CC, 0x6428, 0xD8,
    0x1CA258E, 0x6350, 0xD3,
    0x1D053F6, 0x627D, 0xD1,
    0x1D6753C, 0x61AC, 0xCC,
    0x1DC899B, 0x60DF, 0xC9,
    0x1E29143, 0x6016, 0xC7,
    0x1E88C6D, 0x5F4F, 0xC3,
    0x1EE7B48, 0x5E8C, 0xC0,
    0x1F45E09, 0x5DCC, 0xBD,
    0x1FA34E1, 0x5D0F, 0xBA,
};


// item0 > 0, item1 > 0 ,item2 < 0.
const uint64_t enhanced_sin_t23_p15_q11_database[SIN_SPLIT_NUM * EXPAND_ITEM_NUM] = {
    0x0,	0x6489,	0x7,
    0x3242a,	0x6482,	0x18,
    0x647d9,	0x646a,	0x26,
    0x96a8f,	0x6444,	0x37,
    0xc8bd4,	0x640d,	0x45,
    0xfab26,	0x63c8,	0x55,
    0x12c810,	0x6373,	0x65,
    0x15e215,	0x630e,	0x73,
    0x18f8b7,	0x629b,	0x83,
    0x1c0b82,	0x6218,	0x92,
    0x1f19f9,	0x6186,	0xa1,
    0x2223a5,	0x60e5,	0xb0,
    0x25280b,	0x6035,	0xbe,
    0x2826b9,	0x5f76,	0xcd,
    0x2b1f34,	0x5ea9,	0xdc,
    0x2e110a,	0x5dcd,	0xeb,
    0x30fbc4,	0x5ce2,	0xf8,
    0x33def1,	0x5be9,	0x106,
    0x36ba1f,	0x5ae2,	0x114,
    0x398cdc,	0x59cd,	0x122,
    0x3c56ba,	0x58aa,	0x130,
    0x3f1749,	0x577a,	0x13f,
    0x41ce1e,	0x563c,	0x14c,
    0x447acd,	0x54f0,	0x158,
    0x471ced,	0x5398,	0x166,
    0x49b415,	0x5232,	0x171,
    0x4c3fe1,	0x50c0,	0x17e,
    0x4ebfe8,	0x4f42,	0x18b,
    0x5133cc,	0x4db7,	0x196,
    0x539b2a,	0x4c21,	0x1a3,
    0x55f5a5,	0x4a7e,	0x1ae,
    0x5842de,	0x48d0,	0x1b9,
};

// item0 > 0, item1 < 0 ,item2 < 0.
const uint64_t enhanced_cos_t23_p15_q11_database[SIN_SPLIT_NUM * EXPAND_ITEM_NUM]
{
        0x800001, 0x0, 0x278,
        0x7ff623, 0x278, 0x277,
        0x7fd887, 0x4ef, 0x276,
        0x7fa736, 0x765, 0x276,
        0x7f6236, 0x9db, 0x273,
        0x7f0992, 0xc4f, 0x271,
        0x7e9d57, 0xec0, 0x271,
        0x7e1d94, 0x1130, 0x26d,
        0x7d8a5f, 0x139d, 0x26a,
        0x7ce3cf, 0x1607, 0x267,
        0x7c29fc, 0x186e, 0x262,
        0x7b5d04, 0x1ad1, 0x25e,
        0x7a7d07, 0x1d2f, 0x25b,
        0x798a24, 0x1f89, 0x256,
        0x788484, 0x21df, 0x24f,
        0x776c4f, 0x242f, 0x24a,
        0x7641af, 0x2679, 0x245,
        0x7504d4, 0x28be, 0x23e,
        0x73b5ec, 0x2afc, 0x238,
        0x72552d, 0x2d34, 0x230,
        0x70e2cc, 0x2f65, 0x228,
        0x6f5f04, 0x318e, 0x222,
        0x6dca0e, 0x33b0, 0x219,
        0x6c2429, 0x35c9, 0x212,
        0x6a6d9a, 0x37db, 0x209,
        0x68a6a0, 0x39e4, 0x200,
        0x66cf82, 0x3be4, 0x1f6,
        0x64e889, 0x3dda, 0x1ee,
        0x62f203, 0x3fc8, 0x1e3,
        0x60ec38, 0x41ab, 0x1d9,
        0x5ed77d, 0x4384, 0x1cf,
        0x5cb421, 0x4553, 0x1c4,
};


static uint32_t bclamp(const uint32_t num, uint32_t left, uint32_t right){
	assert(31 >= left && left >= right && right >= 0, "wrong shift bound when clamping.");
	uint32_t tmp = (num << (31 - left)) >> (31 - left);
	return tmp >> right;
}


static uint32_t get_query_idx(uint32_t opcode, uint32_t man) {
	switch (opcode)
	{
	default:
		assert(1 && "not supported opcode");
        break;
	case Opcode::LOG:
		return man >> 17;  // 6bit
    case Opcode::RCP:
        return man >> 16;  // 7bit
	}
}

static void get_s_in_man(uint32_t opcode, uint32_t man, uint32_t& s_in_man, uint32_t& diff, uint32_t& diff_square) {
    switch (opcode)
    {
    default:
        assert(1 && "not supported opcode");
        return;
    case Opcode::LOG: {
        // man 23 bit.
        // s_in_man: get low 17 bit of man, and then >> 16 to get bit 7.
        // get bit 7.
        // (man << 15) >> 15.
        // 15 = 1 + 8 + 6.
        // get man's bit 7
        s_in_man = bclamp(man, 17 - 1, 17 - 1);
        // get low 16 bit of man and 0.
        // xxxx....0, tmp 17 bit.
        // tmp is 17 bit, high 16 bit is man, lower 1 bit is 0
        // 17 bit valid
        uint32_t tmp = (man << 1) & 0x1ffff;
        // if bit 7 is 1, get 17 bit
        // else -tmp
        // diff is 17 bit.
        // if s_in_man that is signed.
        if (s_in_man)
            diff = tmp;
        else
            diff = ((~tmp) & 0x1ffff) + 1; // complement code. -tmp
        // use taylor, 
        //		for diff has scaled 2^-6. 
        //      diff square scaled 2^-12.
        //      we only need 13 t
        // diff_square is only effect the last 
        // log2(1 + x + dx) - log2(1 + x)
        // = dx / (£¨1 +x£© *ln(2)) - dx^2 / 2((1 + x)^2 * ln(2)) +  1/(3 * (1+x + dx')^3 *ln(2)) dx'^3.
        // dx is 2^-6
        // 
        // diff_square's effective bit is 
        // diff_square is 13 bit
        diff_square = ((diff >> 3) * (diff >> 3)) >> 15;

        return;
    }
    }
}

